# Stability Analysis {#stability}

Optimal control formulates a control problem via the language of mathematical optimization. However, there are control problems, and sometimes even the very basic control problems, that cannot be easily stated in the optimal control formulation.

For example, suppose our goal is to _swing up a pendulum to the upright position and stabilize it there_. You may want to formalize the problem as
\begin{equation}
\min_{u(t) \in \mathbb{U}} \int_{0}^{\infty} \Vert x(t) - x_d \Vert^2 dt, \quad \text{subject to} \quad \dot{x} = f(x,u), x(0) = x_0,
(\#eq:pendulum-swingup-stability-test-1)
\end{equation}
where $x_d$ is the desired upright position for the pendulum.  However, does the solution of problem \@ref(eq:pendulum-swingup-stability-test-1), if exists, guarantee the stabilization of the pendulum at the upright position? The answer is unclear without a rigorous proof.

However, after a slight change of perspective, the optimal control problem may be formulated to better match the goal. Suppose there exists a region, $\Omega$, in the state space such that as long as the pendulum enters $\Omega$, there always exists a sequence of control to bring the pendulum to the goal state $x_d$, then we can simply formulate a different optimal control problem
\begin{equation}
\min_{u(t) \in \mathbb{U}} \int_{0}^{T} \Vert u(t) \Vert^2 dt, \quad \text{subject to} \quad x(0)=x_0, x(T) \in \Omega, \dot{x} = f(x,u),
(\#eq:pendulum-swingup-stability-test)
\end{equation}
where now it is very clear, if a solution exists to problem \@ref(eq:pendulum-swingup-stability-test), then we will definitely achieve our goal. This is because the constraint $x(T) \in \Omega$ guarantees that we will be able to stabilize the pendulum, and the cost function of \@ref(eq:pendulum-swingup-stability-test) simply encourages minimum control effort along the way. 

This highlights that, sometimes the formulation of a problem may deserve more thoughts than the actual solution. Of course the formulation \@ref(eq:pendulum-swingup-stability-test) may be much more difficult to solve. In fact, does the set $\Omega$ exist, and if so, how to describe it?

This is the main focus of this chapter: to introduce tools that can help us analyze the _stability_ of uncontrolled and controlled nonlinear systems. Specifically, we will introduce the notion of _stability certificates_, which are conditions that, if hold, certify the stability of the system (e.g., in the set $\Omega$). Interestingly, you will see that the notion of stability certificates is intuitive and easy, but what is really challenging is to _find_ and _compute_ the stability certificates. We will highlight the power and also limitation of computational tools, especially those that are based on convex optimization (see Appendix \@ref(appconvex) for a review of convex optimization).

## Autonomous Systems

Let us first focus on autonomous systems, i.e., systems whose dynamics do not depent on time (and control). We introduce different concepts of stability and ways to certify them.

### Concepts of Stability
Consider the autonomous system
\begin{equation}
\dot{x} = f(x)
(\#eq:autonomous-system)
\end{equation}
where $x \in \mathbb{X} \subseteq \mathbb{R}^n$ is the state and $f: \mathbb{R}^n \rightarrow \mathbb{R}^n$ is the (potentially nonlinear) dynamics.

Before talking about concepts of stability, we need to define an _equilibrium point_.

::: {.definitionbox}
::: {.definition #equilibriumpoint name="Equilibrium Point"}
A state $x^\star$ is called an equilibrium point of system \@ref(eq:autonomous-system) if $f(x^\star) = 0$, i.e., once the system reaches $x^\star$, it stays at $x^\star$.
:::
:::

For example, a linear system
$$
\dot{x} = A x
$$
has a single equilibrium point $x^\star = 0$ when $A$ is nonsingular, and an infinite number of equilibrium points when $A$ is singular (those equilibrium points lie in the kernel of matrix $A$).

When analyzing the behavior of a dynamical system around the equilibrium point, it is often helpful to "shift" the dynamics equation so that $0$ is the equilibrium point. For example, if we are interested in the behavior of system \@ref(eq:autonomous-system) near the equilibrium point $x^\star$, we can create a new variable
$$
z = x - x^\star,
$$
so that 
\begin{equation}
\dot{z} = \dot{x} = f(x) = f(z + x^\star).
(\#eq:shifted-system-by-equilibrium)
\end{equation}
Clearly, $z^\star = 0$ is an equilibrium point for the shifted system \@ref(eq:shifted-system-by-equilibrium).

Let us find the equilibrium points of a simple pendulum.

::: {.examplebox}
::: {.example #pendulumequilibriumpoint name="Equilibrium Points of A Simple Pendulum"}

Consider the dynamics of an uncontrolled pendulum

\begin{equation}
\begin{cases}
\dot{\theta} = \dot{\theta} \\
\ddot{\theta} = - \frac{1}{ml^2} (b \dot{\theta} + mgl \sin \theta)
\end{cases}
(\#eq:pendulum-dynamics-for-equilibrium-point)
\end{equation}
where $\theta$ is the angle between the pendulum and the vertical line, and $x = [\theta,\dot{\theta}]^T$ is the state of the pendulum ($m,g,l,b$ denote the mass, gravity constant, length, and damping constant, respectively). 

To find the equilibrium points of the pendulum, we need the right hand sides of \@ref(eq:pendulum-dynamics-for-equilibrium-point) to be equal to zero:
$$
\dot{\theta} = 0, \quad - \frac{1}{ml^2} (b \dot{\theta} + mgl \sin \theta) = 0.
$$
The solutions are easy to find
$$
x^\star = \begin{bmatrix} 0 \\ 0 \end{bmatrix} \quad \text{or} \quad \begin{bmatrix} \pi \\ 0 \end{bmatrix},
$$
corresponding to the bottomright and upright positions of the pendulum, respectively. 
:::
:::

The pendulum dynamics has two equilibrium points, but our physics intuition tells us these two equilibrium points are dramatically different. Specifically, the bottomright equilibrium $x^\star = [0,0]^T$ is such that if you perturb the pendulum around the equilibrium, the pendulum will go back to that equilibrium; the upright equilibrium $x^\star = [\pi,0]^T$ is such that if you perturb the pendulum (even just a little bit) around the equilibrium, it will diverge from that equilibrium. 

This physical intuition is exactly what we want to formalize as the concepts of stability.

In the following, we focus on the nonlinear autonomous system \@ref(eq:autonomous-system) with $f(0) = 0$, i.e., $x^\star = 0$ is an equilibrium point. We now formally define the different concepts of stability.

::: {.definitionbox}
::: {.definition #lyapunovstability name="Lyapunov Stability"}
The equilibrium point $x=0$ is said to be _stable in the sense of Lyapunov_ if, for any $R > 0$, there exists $r >0$ such that if $\Vert x(0) \Vert < r$, then $\Vert x(t) \Vert < R$ for all $t \geq 0$. Otherwise, the equilibrium point is unstable.
:::
:::

For a system that is Lyapunov stable around $x=0$, the definition says that, if we want to constrain the trajectory of the system to be within the ball $B_R = \{ x \mid \Vert x \Vert < R \}$, then we can always find a smaller ball $B_r = \{ x \mid \Vert x \Vert < r \}$ such that if the system starts within $B_r$, it will remain in the larger ball $B_R$. 

On the other hand, if the system is not Lyapunov stable at $x=0$, then there exists at least one ball $B_R$, such that no matter how close the system's initial condition is to the origin, it will eventually exit the ball $B_R$. The following exercise is left for you to verify the instability of the Van der Pol oscillator.

::: {.exercise #instabilityvanderpol name="Instability of the Van der Pol oscillator"}
Show that the Van der Pol oscillator
$$
\begin{cases}
\dot{x}_1 = x_2 \\
\dot{x}_2 = - x_1 + (1-x_1^2) x_2
\end{cases}
$$
is unstable at the equilibrium point $x = 0$.
:::

Lyapunov stability does not guarantee the system trajectory will actually converge to $x =0$. Instead, asymptotic stability will ask the system trajectory to converge to $x=0$.

::: {.definitionbox}
::: {.definition #asymptoticstability name="Asymptotic Stability and Domain of Attraction"}
The equilibrium point $x = 0$ is said to be _asymptotically stable_ if (i) it is Lyapunov stable, and (ii) there exists some $r > 0$ such that $x(0) \in B_r$ implies $x(t) \rightarrow 0$ as $t \rightarrow 0$. 

_The_ domain of attraction (for the equilibrium $x=0$) is the largest set of points in the state space such that trajectories initiated at those points will converge to the equilibrium point. That is,
$$
\Omega(x^\star) = \{ x \in \mathbb{X} \mid x(0) = x \Longrightarrow \lim_{t \rightarrow \infty} x(t) = x^\star \}.
$$
The ball $B_r$ is _a_ domain of attraction for the equilibrium point $x=0$, but not necessarily the largest domain of attraction.
:::
:::

You may immediately realize that in the definition of asymptotic stability, we require Lyapunov stability to hold first. Is this necessary? i.e., does there exist a system where trajectories eventually converge to zero, but is not stable in the sense of Lyapunov? You should work out the following exercise.

::: {.exercise #vinogradequation name="Vinograd System"}
Show that for the Vinograd dynamical system [@vinograd57-inapplicability]
$$
\begin{cases}
\dot{x} = \frac{x^2(y-x) + y^5}{(x^2+y^2)(1 + (x^2+y^2)^2)} \\
\dot{y} = \frac{y^2 (y - 2x)}{(x^2+y^2)(1 + (x^2+y^2)^2)}
\end{cases},
$$
all system trajectories converge to the equilibrium point $(x,y) = 0$, but the equilibrium point is not stable in the sense of Lyapunov.

(Hint: the system trajectories will behave like the following plot.)

```{r vinograd-system, out.width='60%', fig.show='hold', fig.cap='Trajectories of the Vinograd system. Copied from the original article of Vinograd.', fig.align='center', echo=FALSE}
knitr::include_graphics('images/vinograd.png')
```
:::

In many cases, we want the convergence of the system trajectory towards $x=0$ to be fast, thus bringing in the notion of exponential stability.

::: {.definitionbox}
::: {.definition #exponentialstability name="Exponential Stability"}

An equilibrium point $x=0$ is said to be exponentially stable, if there exists a ball $B_r$ such that as long as as $x(0) \in B_r$, then
$$
\Vert x(t) \Vert \leq \alpha \Vert x(0) \Vert e^{-\lambda t}, \quad \forall t,
$$
for some $\alpha > 0$ and $\lambda > 0$ ($\lambda$ is called the rate of exponential convergence). 
:::
:::

Exponential stability implies asymptotic stability (and certainly also Lyapunov stability). What is nice about exponential stability is that we can quantify the distance of the system trajectory to the equilibrium point as a function of time (as long as we know the constants $\alpha, \Vert x(0) \Vert, \lambda$). In many safety-critical applications, we need such performance guarantees. For example, in Chapter \@ref(state-observer), we will see the application of exponential stability in observer-feedback control.

All the concepts of stability we have mentioned so far only talk about the stability of the system _locally_ around the equilibrium point $x=0$ (via arguments like $B_r$ and $B_R$). It would be much nicer if we can guarantee stability of the system _globally_, i.e., no matter where the system starts in the state space $\mathbb{X}$, its trajectoy will converge to $x=0$.


::: {.definitionbox}
::: {.definition #globalstability name="Global Asymptotic and Exponential Stability"}

The equilibrium point $x = 0$ is said to be globally asymptotically (exponentially) stable if asymptotic (exponential) stability holds for any initial states. That is,
$$
\forall x \in \mathbb{X}, \quad x(0) = x \Longrightarrow \begin{cases}
\lim_{t \rightarrow \infty} x(t) = 0  & \text{global asymptotic stability} \\
\exists \alpha, \lambda > 0, \text{ s.t. } \Vert x(t) \Vert \leq \alpha \Vert x(0) \Vert e^{-\lambda t} & \text{global exponential stability}
\end{cases}
$$
:::
:::

This concludes our definitions of stability for nonlinear systems (Definition \@ref(def:lyapunovstability)-\@ref(def:globalstability)). It is worth mentioning that the concepts of stability are complicated (refined) here due to our focus on nonlinear systems. For linear systems, the concepts of stability are simpler. Specifically, all local stability properties of linear systems are also global and asymptotic stability is equal to exponential stability. In fact, for a linear time-invariant system $\dot{x} = Ax$, it is either asymptotically (exponentially) stable, or marginally stable, or unstable. Moreover, we can fully characterize the stability property by inspecting the eigenvalues of $A$ (you can find a refreshment of this in Appendix \@ref(app-lti-stability)). 

How do we characterize the stability property of a nonlinear system? If someone gave me a nonlinear system \@ref(eq:autonomous-system), how can I provide a certificate to her that the system is stable or unstable (I cannot use eigenvalues anymore in this case)? Let us describe some of these certificates below.

### Stability by Linearization

A natural idea is to linearize, if possible, the nonlinear system \@ref(eq:autonomous-system) at a given equilibrium point $x^\star$ and inspect the stability of the linearized system (for which we can compute eigenvalues). Therefore, the key question here is how does the stability and instability of the linearized system relate to the stability and instability of the original nonlinear system. 

::: {.theorembox}
::: {.theorem #stabilitybylinearization name="Stability by Linearization"}
Assume $x=0$ is an equilibrium point of system \@ref(eq:autonomous-system) and $f$ is continuously differentiable. Let
\begin{equation}
\dot{x} = Ax, \quad A = \frac{\partial f}{\partial x} \Big\vert_{x=0}
(\#eq:linearized-system)
\end{equation}
be the linearized system at $x=0$. The following statements are true about the stability relationship between \@ref(eq:autonomous-system) and \@ref(eq:linearized-system).

- If the linearized system \@ref(eq:linearized-system) is strictly stable (i.e., all eigenvalues of $A$ have strictly negative real parts), then the original system \@ref(eq:autonomous-system) is asymptotically stable at $x=0$.

- If the linearized system \@ref(eq:linearized-system) is unstable (i.e., at least one eigenvalue of $A$ has strictly positive real part), then the original system \@ref(eq:autonomous-system) is unstable at $x=0$.

- If the linearized system \@ref(eq:linearized-system) is marginally stable (i.e., all eigenvalues of $A$ have nonpositive real parts, and at least one eigenvalue has zero real part), then the stability of the original system \@ref(eq:autonomous-system) at $x=0$ is indeterminate.
:::
:::

Theorem \@ref(thm:stabilitybylinearization) is actually quite useful when we want to quickly examine the local stability of a nonlinear system around a given equilibrium point, as we will show in the next example.

::: {.examplebox}
::: {.example #pendulumstabilitybylinearization name="Stability of A Simple Pendulum by Linearization"}
Consider the simple pendulum dynamics \@ref(eq:pendulum-dynamics-for-equilibrium-point) in Example \@ref(exm:pendulumequilibriumpoint). Without loss of generality, let $m=1,l=1,b=0.1$. The Jacobian of the nonlinear dynamics reads
$$
A = \frac{\partial f}{\partial x} = 
\begin{bmatrix}
0 & 1 \\
-\frac{g}{l} \cos \theta & -\frac{b}{ml^2}
\end{bmatrix}.
$$

At the bottomright equilibrium point $\theta =0, \dot{\theta} = 0$, the matrix $A$ has two eigenvalues
$$
-0.0500 \pm 3.13i,
$$
and hence the pendulum is asymptotically stable at the bottomright equilibrium point.

At the upright equilibrium point $\theta =\pi, \dot{\theta} = 0$, the matrix $A$ has two eigenvalues 
$$
3.08, \quad -3.18,
$$
and hence the pendulum is unstable at the upright equilibrium point.
:::
:::

The linearization method is easy to carry out. However, it tells us nothing about global stability or exponential stability. Moreover, when the linearized system is marginally stable, the stability of the orignal system is inconclusive. In the next, we will introduce a more general, and perhaps the most popular framework for analyzing the stability of nonliear systems.

### Lyapunov Analysis







::: {.theorembox}
::: {.theorem #lyapunovglobalstability name="Lyapunov Global Stability"}
For the autonomous system \@ref(eq:autonomous-system), suppose there exists a scalar function $V(x)$ with continuous first order derivatives such that 

- $V(x)$ is positive define;

- $\dot{V}(x)$ is negative define;

- $V(x) \rightarrow \infty$ as $\Vert x \Vert \rightarrow \infty$,

then the equilibrium point $x = 0$ is globally asymptotically stable.
:::
:::


::: {.lemma #Barbalat name="Barbalat's Lemma"}
Let $f(t)$ be differentiable, if 

- $\lim_{t \rightarrow \infty} f(t)$ is finite, and  

- $\dot{f}(t)$ is uniformly continuous,^[A sufficient condition for this to hold is that $\ddot{f}$ exists and is bounded.]

then 
$$
\lim_{t \rightarrow \infty} \dot{f}(t) = 0.
$$
:::

::: {.theorembox}
::: {.theorem #BarbalatStability name="Barbalat's Stability Certificate"}
If a scalar function $V(x,t)$ satisfies

- $V(x,t)$ is lower bounded,

- $\dot{V}(x,t)$ is negative semidefinite 

- $\dot{V}(x,t)$ is uniformly continuous

then $\dot{V}(x,t) \rightarrow 0$ as $t \rightarrow \infty$.
:::
:::
::: {.proofbox}
::: {.proof}
$V(x,t)$ is lower bounded and $\dot{V}$ is negative semidefinite implies the limit of $V$ as $t \rightarrow \infty$ is finite (note that $V(x,t) \leq V(x(0),0)$). Then the theorem clearly follows from Barbalat's Lemma \@ref(lem:Barbalat).
:::
:::

